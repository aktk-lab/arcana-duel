<!doctype html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>アルカナデュエル — 大＋小アルカナ（JP & Icons）</title>
<link rel="manifest" href="/arcana-duel/manifest.webmanifest"><meta name="theme-color" content="#070a18">
<style>
:root{ --bg:#070a18; --panel:#0d1230; --text:#f0f6ff; --muted:#cfd8ff; --border:#1e2b60; --btn:#3658ff; }
*{box-sizing:border-box;font-family:"Hiragino Kaku Gothic ProN","Yu Gothic",system-ui,Segoe UI,Roboto,sans-serif}
body{margin:0;background:radial-gradient(1200px 600px at 50% -10%, #162258, #070a18 60%);color:var(--text)}
header{padding:14px 16px 10px;text-align:center;background:linear-gradient(180deg,#12206a,#0b1136 60%,rgba(0,0,0,0));position:sticky;top:0;z-index:5}
h1{font-size:19px;margin:0;letter-spacing:.3px}
.scores{display:flex;gap:12px;justify-content:center;color:#a9b8ff;font-size:14px;margin:8px 0;flex-wrap:wrap}
.wrap{padding:8px 12px 18px;max-width:980px;margin:0 auto}
.row{display:flex;justify-content:space-between;align-items:center;margin:8px 0;gap:10px;flex-wrap:wrap}
.pill{padding:7px 12px;border-radius:999px;background:#12215a;border:1px solid #263a88;font-size:12px;color:#cfe0ff}
.badge{padding:6px 10px;border-radius:999px;background:#16235a;border:1px solid #2a3c88;font-size:12px;color:#cfe0ff}
.section{color:#a9b8ff;margin:10px 2px 6px 2px;font-size:14px}
.lane{display:flex;gap:12px;overflow:auto;padding:2px 2px 10px 2px;scroll-snap-type:x mandatory}
.card{min-width:180px;background:linear-gradient(180deg,#10183f,#0d1230);border:1px solid var(--border);border-radius:16px;padding:10px;scroll-snap-align:start}
.cardArt{height:220px;border-radius:12px;background:#091126;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.cardName{margin:10px 0 2px 0;font-weight:800;letter-spacing:.4px}
.subtitle{font-size:11px;color:#90a0ff;margin-bottom:6px}
.btn{background:linear-gradient(180deg,#4c6dff,#2b48ec);border:none;color:#f7fbff;padding:10px;border-radius:11px;width:100%;font-weight:800;letter-spacing:.3px}
.log{background:linear-gradient(180deg,#0c1232,#0a0f26);border:1px solid #1b2a66;border-radius:14px;padding:12px;color:#cfd8ff;min-height:110px}
.tag{position:absolute;left:8px;top:8px;font-size:11px;background:#142264;color:#e6efff;border:1px solid #2f48a0;padding:2px 8px;border-radius:999px;z-index:3}
.shine{position:absolute;inset:-20%;background:conic-gradient(from 0deg at 50% 50%, rgba(255,255,255,.07), rgba(255,255,255,0));filter:blur(8px);animation:spin 14s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.glow{filter:drop-shadow(0 0 6px rgba(120,180,255,.55))}
.tooltip{position:fixed;left:12px;right:12px;bottom:12px;background:#0e153c;border:1px solid #2a3f9a;border-radius:12px;padding:12px;box-shadow:0 12px 32px rgba(0,0,0,.45);display:none}
.tooltip h3{margin:0 0 6px;font-size:14px}
.tooltip p{margin:2px 0;color:#cfe0ff;font-size:12px}
.tooltip .close{float:right;background:#2b48ec;color:#fff;border:0;border-radius:8px;padding:6px 10px}
</style>
</head><body>
<header>
  <h1>アルカナデュエル — 大＋小アルカナ（PWA）</h1>
  <div class="scores"><div>あなた: <span id="ps">0</span></div><div>AI: <span id="as">0</span></div><div>ラウンド <span id="rd">1</span>/5</div></div>
</header>
<div class="wrap">
  <div class="row">
    <div class="pill">デッキ残り: <span id="dk">0</span></div>
    <div class="badge">コイン: <span id="coins">0</span></div>
    <div class="badge">次ターン小＋1: <span id="qbonus">0</span></div>
    <label class="pill" style="display:flex;gap:6px;align-items:center;"><input id="sfx" type="checkbox" checked style="accent-color:#6da1ff"> 効果音</label>
    <button id="reset" class="pill">リセット</button>
  </div>
  <div class="section">大アルカナ（得点源）</div><div id="laneMajor" class="lane"></div>
  <div class="section">小アルカナ（1枚だけ添付可）</div><div id="laneMinor" class="lane"></div>
  <div class="section">ログ</div><div id="log" class="log"></div>
</div>
<div id="tip" class="tooltip"><button class="close" onclick="this.parentElement.style.display='none'">閉じる</button><h3 id="tipTitle">カード情報</h3><p id="tipBody"></p></div>
<script>
if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/arcana-duel/sw.js').catch(()=>{}); }); }
let MINOR_DICT=null; fetch('/arcana-duel/minor-cards-ja.json').then(r=>r.json()).then(j=>{ MINOR_DICT={}; j.forEach(x=>{ MINOR_DICT[`${x.suit_key}-${x.rank_key}`]=x; }); }).catch(()=>{});
const ARCANA=[['FOOL','愚者','The Fool',5],['MAGICIAN','魔術師','The Magician',5],['HIGH_PRIESTESS','女教皇','The High Priestess',5],['EMPRESS','女帝','The Empress',5],['EMPEROR','皇帝','The Emperor',5],['HIEROPHANT','法皇','The Hierophant',5],['LOVERS','恋人','The Lovers',5],['CHARIOT','戦車','The Chariot',5],['STRENGTH','力','Strength',5],['HERMIT','隠者','The Hermit',5],['WHEEL','運命の輪','Wheel of Fortune',5],['JUSTICE','正義','Justice',5],['HANGED','吊るされた男','The Hanged Man',5],['DEATH','死神','Death',5],['TEMPERANCE','節制','Temperance',5],['DEVIL','悪魔','The Devil',5],['TOWER','塔','The Tower',5],['STAR','星','The Star',5],['MOON','月','The Moon',5],['SUN','太陽','The Sun',5],['JUDGEMENT','審判','Judgement',5],['WORLD','世界','The World',15]];
const MAJORS=ARCANA.map((a,i)=>({type:'major', key:a[0], jp:a[1], name:a[2], value:a[3], hue:(190+i*9)%360}));
const SUITS=['WANDS','CUPS','SWORDS','PENTACLES']; const RANKS=['A','2','3','4','5','6','7','8','9','10','PAGE','KNIGHT','QUEEN','KING'];
function rankBoost(r){ if(r==='PAGE')return 2; if(r==='KNIGHT')return 3; if(r==='QUEEN')return 3; if(r==='KING')return 4; const n=parseInt(r,10); if(n>=1&&n<=3)return 1; if(n>=4&&n<=6)return 2; if(n>=7&&n<=10)return 3; return 0; }
function makeMinorDeck(){ const out=[]; SUITS.forEach((s,si)=>{ RANKS.forEach(r=>{ out.push({type:'minor', suit:s, rank:r, hue:(40+si*80)%360, uid:`${s}-${r}-${Math.random()}`}); }); }); return out; }
let deck=[],pMaj=[],pMin=[],aiMaj=[],aiMin=[],pScore=0,aScore=0,round=1,coins=0,nextMinorBonus=0;
let audioCtx=null; function tone(f=440,d=0.12,t='sine',g=0.06){ const cb=document.getElementById('sfx'); if(!cb||!cb.checked)return; if(!audioCtx){ try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){return;} } const ct=audioCtx.currentTime,o=audioCtx.createOscillator(),gn=audioCtx.createGain(); o.type=t; o.frequency.value=f; gn.gain.value=g; o.connect(gn); gn.connect(audioCtx.destination); o.start(ct); gn.gain.exponentialRampToValueAtTime(0.0001, ct+d); o.stop(ct+d+0.02); }
function sfxPlay(){ tone(720,0.09,'triangle'); setTimeout(()=>tone(1040,0.08,'triangle'),90); } function sfxAi(){ tone(420,0.10,'sawtooth'); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function drawTo(arr,n){ for(let i=0;i<n&&deck.length;i++){ arr.push(deck.shift()); } updateTop(); }
function updateTop(){ dk.textContent=deck.length; ps.textContent=pScore; as.textContent=aScore; rd.textContent=round; coinsEl.textContent=coins; qbonus.textContent=nextMinorBonus; }
function log(msg){ logEl.innerHTML='・'+msg+'<br>'+logEl.innerHTML; }
function bg(uid,h){ return `<defs><linearGradient id="g${uid}" x1="0" x2="1"><stop offset="0%" stop-color="hsl(${h},86%,64%)"/><stop offset="100%" stop-color="hsl(${(h+18)%360},72%,46%)"/></linearGradient></defs><rect x="0" y="0" width="100" height="150" fill="url(#g${uid})" opacity=".22"/>`; }
function SV(s){ return `<svg class="glow" viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">${s}</svg>`; }
const ART_MAJOR={WORLD:(u,h)=>SV(bg(u,h)+`<g stroke="hsl(${h},92%,90%)" fill="none" stroke-width="2" transform="translate(50,74)"><ellipse rx="30" ry="44"/><path d="M-20,-34 q-8,14 0,28"/><path d="M20,-34 q8,14 0,28"/><path d="M-20,6 q-8,14 0,28"/><path d="M20,6 q8,14 0,28"/></g><g stroke="hsl(${h},92%,90%)" fill="none" stroke-width="2"><circle cx="50" cy="58" r="6"/><path d="M50 64 q-12 18 0 36 q12 -18 0 -36"/><path d="M44 104 q6 8 12 0"/></g>`)};
function majorArt(c){ const fn=ART_MAJOR[c.key]; return fn?fn(c.uid||c.key,c.hue):SV(bg(c.uid||c.key,c.hue)); }
function minorArt(c){ const h=c.hue,s=c.suit,r=c.rank,uid=c.uid||(s+r); let symbol=''; if(s==='WANDS')symbol='<path d="M20 120 L80 30"/>'; if(s==='CUPS')symbol='<path d="M30 70 q20 -18 40 0 v12 h-40 z"/>'; if(s==='SWORDS')symbol='<path d="M50 28 v80 M42 92 h16"/>'; if(s==='PENTACLES')symbol='<circle cx="50" cy="76" r="12"/><path d="M50 64 l4 10 h10 l-8 6 l4 10 l-10 -6 l-10 6 l4 -10 l-8 -6 h10 z"/>'; const jp=MINOR_DICT&&MINOR_DICT[`${s}-${r}`]; const lbl=jp?jp.label_jp:`${s}/${r}`; return `<div class="tag">${lbl}</div>`+SV(bg(uid,h)+`<g stroke="hsl(${h},92%,88%)" fill="none" stroke-width="2">${symbol}</g>`); }
function showTip(t,b){ tipTitle.textContent=t; tipBody.textContent=b; tip.style.display='block'; }
let pendingMajorUid=null;
function makeCardElMajor(c){ const w=document.createElement('div'); w.className='card'; const a=document.createElement('div'); a.className='cardArt'; const tag=document.createElement('div'); tag.className='tag'; tag.textContent=`${c.jp} / ${c.name}（+${c.value}）`; a.appendChild(tag); a.innerHTML+=majorArt(c); a.addEventListener('click',()=>showTip(`${c.jp} / ${c.name}`,`このカードは+${c.value}点。`)); const name=document.createElement('div'); name.className='cardName'; name.textContent=c.jp; const sub=document.createElement('div'); sub.className='subtitle'; sub.textContent=c.name; const b=document.createElement('button'); b.className='btn'; b.textContent='この大アルカナを出す'; b.addEventListener('click',()=>chooseMinor(c.uid)); w.appendChild(a); w.appendChild(name); w.appendChild(sub); w.appendChild(b); return w; }
function makeCardElMinor(c){ const w=document.createElement('div'); w.className='card'; const a=document.createElement('div'); a.className='cardArt'; const jp=MINOR_DICT&&MINOR_DICT[`${c.suit}-${c.rank}`]; const tag=document.createElement('div'); tag.className='tag'; tag.textContent=jp?jp.label_jp:`${c.suit}/${c.rank}`; a.appendChild(tag); a.innerHTML+=minorArt(c); if(jp){ a.addEventListener('click',()=>showTip(jp.label_jp, `${jp.suit_effect_jp} / B=${jp.rank_points}`)); } const name=document.createElement('div'); name.className='cardName'; name.textContent=jp?jp.suit_jp:c.suit; const sub=document.createElement('div'); sub.className='subtitle'; sub.textContent=jp?`ランク ${jp.rank_jp}（B=${jp.rank_points}）`:`ランク ${c.rank}`; const b=document.createElement('button'); b.className='btn'; b.textContent='この小アルカナを添える'; b.addEventListener('click',()=>playTurn(pendingMajorUid,c.uid)); w.appendChild(a); w.appendChild(name); w.appendChild(sub); w.appendChild(b); return w; }
function renderLanes(){ laneMajor.innerHTML=''; pMaj.forEach(c=>laneMajor.appendChild(makeCardElMajor(c))); laneMinor.innerHTML=''; pMin.forEach(c=>laneMinor.appendChild(makeCardElMinor(c))); }
function chooseMinor(uid){ pendingMajorUid=uid; renderLanes(); const sk=document.createElement('button'); sk.className='pill'; sk.style.margin='6px'; sk.textContent='（添付しないで出す）スキップ'; sk.addEventListener('click',()=>playTurn(pendingMajorUid,null)); laneMinor.prepend(sk); }
function aiChoose(){ aiMaj.sort((a,b)=>b.value-a.value); const major=aiMaj.shift(); let minor=null; if(aiMin.length){ const ord={'SWORDS':3,'WANDS':2,'CUPS':1,'PENTACLES':0}; aiMin.sort((a,b)=>{ const bb=rankBoost(b.rank)-rankBoost(a.rank); if(bb!==0)return bb; return (ord[b.suit]||0)-(ord[a.suit]||0); }); minor=aiMin.shift(); } return {major,minor}; }
function playTurn(mu,nu){ const i=pMaj.findIndex(c=>c.uid===mu); if(i<0)return; const M=pMaj.splice(i,1)[0]; let N=null; if(nu){ const j=pMin.findIndex(c=>c.uid===nu); if(j>=0) N=pMin.splice(j,1)[0]; } const A=aiChoose(); let pr=M.value, ar=A.major.value; if(N){ const b=rankBoost(N.rank); if(N.suit==='WANDS')pr+=b; else if(N.suit==='CUPS'){ pr+=b; ar=Math.max(0,ar-Math.max(0,b-1)); } else if(N.suit==='SWORDS'){ ar=Math.max(0,ar-b); } else if(N.suit==='PENTACLES'){ pr+=1; coins+=1; } if(N.rank==='QUEEN') nextMinorBonus+=1; } if(A.minor){ const b=rankBoost(A.minor.rank); if(A.minor.suit==='WANDS') ar+=b; else if(A.minor.suit==='CUPS'){ ar+=b; pr=Math.max(0,pr-Math.max(0,b-1)); } else if(A.minor.suit==='SWORDS'){ pr=Math.max(0,pr-b); } else if(A.minor.suit==='PENTACLES'){ ar+=1; } } pScore+=pr; aScore+=ar; try{sfxPlay(); sfxAi();}catch(e){} log(`あなた：${M.jp}（+${M.value}） ${N?`＋ 小:${N.suit}/${N.rank}`:'（小なし）'} → 合計 +${pr}`); log(`AI　　：${A.major.jp}（+${A.major.value}） ${A.minor?`＋ 小:${A.minor.suit}/${A.minor.rank}`:'（小なし）'} → 合計 +${ar}`); drawTo(pMaj,Math.max(0,3-pMaj.length)); let tgt=3+Math.min(1,nextMinorBonus); drawTo(pMin,Math.max(0,tgt-pMin.length)); if(nextMinorBonus>0) nextMinorBonus-=1; drawTo(aiMaj,Math.max(0,3-aiMaj.length)); drawTo(aiMin,Math.max(0,3-aiMin.length)); round++; updateTop(); renderLanes(); if(round>5){ const bonus=Math.floor(coins/3)*2; pScore+=bonus; let res=`ゲーム終了\nあなた ${pScore}（コインボーナス +${bonus}） : AI ${aScore}\n`; res+=(pScore===aScore)?'→ 引き分け':(pScore>aScore?'→ あなたの勝ち！':'→ AIの勝ち…'); setTimeout(()=>alert(res),40); } }
function resetGame(){ deck=[]; for(let k=0;k<2;k++) deck=deck.concat(MAJORS.map(c=>({...c, uid:c.key+'-'+k+'-'+Math.random()}))); deck=deck.concat(makeMinorDeck()); shuffle(deck); pMaj=[]; pMin=[]; aiMaj=[]; aiMin=[]; pScore=0; aScore=0; round=1; coins=0; nextMinorBonus=0; logEl.innerHTML=''; drawTo(pMaj,3); drawTo(aiMaj,3); drawTo(pMin,3); drawTo(aiMin,3); updateTop(); renderLanes(); }
const dk=document.getElementById('dk'), ps=document.getElementById('ps'), as=document.getElementById('as'), rd=document.getElementById('rd'), coinsEl=document.getElementById('coins'), qbonus=document.getElementById('qbonus'), laneMajor=document.getElementById('laneMajor'), laneMinor=document.getElementById('laneMinor'), logEl=document.getElementById('log'), tip=document.getElementById('tip'), tipTitle=document.getElementById('tipTitle'), tipBody=document.getElementById('tipBody');
document.getElementById('reset').addEventListener('click', resetGame); resetGame();
</script></body></html>
